{% extends "_layout.html" %}
{% block title %}Codebases{% endblock %}
{% block content %}
<h1>Codebases</h1>
{% if error %}<p class="error">{{ error }}</p>{% endif %}
{% if success %}<p class="success">{{ success }}</p>{% endif %}
<div class="card">
    <div class="status" style="margin-bottom:0.5rem;color:#555;">workspaces_root: {{ workspaces_root }} | codebases_count: {{ codebases_count }}</div>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Label</th>
                <th>Owner</th>
                <th>Created</th>
                <th>Last Used</th>
                <th>Path</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for cb in codebases or [] %}
            <tr>
                <td>{{ cb.id }}</td>
                <td>{{ cb.label }}</td>
                <td>{{ cb.owner or '' }}</td>
                <td>{{ cb.created_at or '' }}</td>
                <td>{{ cb.last_used_at or '' }}</td>
                <td style="font-family:monospace;">{{ cb.path }}</td>
                <td>
                    {% if confirm_action and confirm_codebase == cb.id %}
                    <form method="post" action="/codebases/action" style="display:inline;">
                        <input type="hidden" name="action" value="{{ confirm_action }}">
                        <input type="hidden" name="codebase_id" value="{{ cb.id }}">
                        <button type="submit">Confirm {{ confirm_action }}</button>
                    </form>
                    <a href="/codebases" style="margin-left:0.5rem;">Cancel</a>
                    {% else %}
                    <a href="/codebases?confirm=archive&codebase_id={{ cb.id }}">Archive</a> |
                    <a href="/codebases?confirm=delete&codebase_id={{ cb.id }}">Delete</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
            {% if (codebases or [])|length == 0 %}
            <tr><td colspan="7" style="text-align:center;color:#777;">No codebases found.</td></tr>
            {% endif %}
        </tbody>
    </table>
</div>
<div class="card" style="margin-top:1rem;">
    <h3>Debug</h3>
    <pre style="white-space:pre-wrap;">{{ debug_json }}</pre>
</div>
{% endblock %}
