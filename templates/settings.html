{% extends "_layout.html" %}
{% block title %}Settings{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <div>
        <h1 class="mb-1">Global Settings</h1>
        <p class="text-muted mb-0">Tune retention and disk safeguards for every workspace.</p>
    </div>
</div>

<div id="settings-response" class="mb-3"></div>

<form class="row g-3" hx-post="/settings/update" hx-target="#settings-response">
  <div class="col-md-8 col-lg-6">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <i class="bi bi-shield-check text-primary me-2 fs-4"></i>
          <div>
            <h5 class="card-title mb-0">System Policies</h5>
            <small class="text-muted">Retention and disk safety thresholds.</small>
          </div>
        </div>
        <div class="mb-3">
          <label class="form-label" for="prune_days">Prune Days</label>
          <input type="number" min="0" class="form-control" id="prune_days" name="prune_days" value="{{ settings.prune_days_age }}">
        </div>
        <div class="mb-3">
          <label class="form-label" for="delete_days">Delete Days</label>
          <input type="number" min="0" class="form-control" id="delete_days" name="delete_days" value="{{ settings.delete_days_age }}">
        </div>
        <div class="mb-3">
          <label class="form-label" for="disk_min">Disk Threshold (GB)</label>
          <input type="number" min="0" class="form-control" id="disk_min" name="disk_min" value="{{ settings.disk_min_free_gb }}">
          <div class="form-text">Minimum free disk space to keep before new jobs are scheduled.</div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 d-flex justify-content-between align-items-center mt-2">
    <small class="text-muted">Changes apply instantly and are stored centrally.</small>
    <button type="submit" class="btn btn-primary">Save Settings</button>
  </div>
</form>

<div class="row g-3 mt-2">
  <div class="col-md-8 col-lg-6">
    <div class="card h-100">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <i class="bi bi-hdd-stack text-primary me-2 fs-4"></i>
          <div>
            <h5 class="card-title mb-0">Storage Maintenance</h5>
            <small class="text-muted">Manual cleanup for shared Yocto caches.</small>
          </div>
        </div>
        <div class="mb-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-semibold">SState Cache</div>
            <span class="badge bg-light text-dark">/work/sstate-cache</span>
          </div>
          <form class="row g-2 align-items-end" hx-post="/settings/cleanup" hx-target="#settings-response">
            <input type="hidden" name="target" value="sstate">
            <div class="col-8">
              <label class="form-label" for="sstate_days">Days Unused</label>
              <input type="number" min="0" class="form-control" id="sstate_days" name="days" value="30">
            </div>
            <div class="col-4">
              <button type="submit" class="btn btn-outline-primary w-100">Clean</button>
            </div>
          </form>
          <div class="form-text">Deletes files with access time older than the specified days.</div>
        </div>
        <div>
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="fw-semibold">Downloads</div>
            <span class="badge bg-light text-dark">/work/downloads</span>
          </div>
          <form class="row g-2 align-items-end" hx-post="/settings/cleanup" hx-target="#settings-response">
            <input type="hidden" name="target" value="downloads">
            <div class="col-8">
              <label class="form-label" for="downloads_days">Days Unused</label>
              <input type="number" min="0" class="form-control" id="downloads_days" name="days" value="30">
            </div>
            <div class="col-4">
              <button type="submit" class="btn btn-outline-primary w-100" title="Only root files will be deleted">Clean</button>
            </div>
          </form>
          <div class="form-text">Only root-level files are removed; subdirectories are preserved.</div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
