{% extends "_layout.html" %}
{% block title %}Project Templates{% endblock %}
{% block content %}
<h1>Project Template v1</h1>
{% if error %}<p class="error">{{ error }}</p>{% endif %}
{% if success %}<p class="success">{{ success }}</p>{% endif %}

<div class="flex" style="gap:1rem;flex-wrap:wrap;">
    <div class="card" style="flex: 2;min-width:360px;">
        <h2>Create / Save Recipe</h2>
        <form method="post" action="/projects" style="display:grid;grid-template-columns:1fr 1fr;gap:0.75rem;align-items:start;">
            <div style="display:flex;flex-direction:column;gap:0.75rem;">
                <div class="flex" style="gap:0.75rem;flex-wrap:wrap;">
                    <label style="flex:1;min-width:200px;">Platform
                        <input type="text" name="platform" value="{{ platform or '' }}" placeholder="e.g. ast2600">
                    </label>
                    <label style="flex:1;min-width:200px;">Project
                        <input type="text" name="project" value="{{ project or '' }}" placeholder="e.g. base">
                    </label>
                </div>
                <label>Display Name
                    <input type="text" name="display_name" value="{{ display_name or '' }}" placeholder="Human-friendly name">
                </label>
                <label>Workdir
                    <input type="text" name="workdir" value="{{ workdir or '' }}" placeholder="Optional workdir (e.g. onetree)">
                </label>
                <label>Clone Commands (one per line)
                    <textarea name="clone_lines" rows="4" placeholder="git clone ...&#10;cd repo">{{ clone_lines or '' }}</textarea>
                </label>
                <label>Init Commands (one per line)
                    <textarea name="init_lines" rows="4" placeholder="source env script&#10;export VAR=...">{{ init_lines or '' }}</textarea>
                </label>
                <label>Build Commands (one per line)
                    <textarea name="build_lines" rows="4" placeholder="bitbake ...">{{ build_lines or '' }}</textarea>
                </label>
                <div class="flex" style="gap:0.5rem;flex-wrap:wrap;">
                    <button type="submit">Preview YAML</button>
                    <button type="submit" name="save" value="1">Save Recipe</button>
                </div>
            </div>
            <div style="display:flex;flex-direction:column;gap:0.5rem;">
                <label>Generated Recipe YAML (preview)
                    <textarea readonly rows="18" style="font-family:monospace;">{{ generated_yaml or '' }}</textarea>
                </label>
                <div class="status" style="color:#555;font-size:0.9rem;">Schema: Project Template v1. Use Preview to inspect, Save writes to filesystem.</div>
            </div>
        </form>
    </div>
    <div class="card" style="flex: 1;min-width:280px;">
        <h2>Debug</h2>
        <p><strong>presets_root:</strong> {{ presets_root }}</p>
        <p><strong>recipes_count:</strong> {{ recipes_count }}</p>
        <p><strong>last_error:</strong> {{ last_error or 'None' }}</p>
    </div>
</div>

<div class="card" style="margin-top:1rem;">
    <h2>generated_yaml</h2>
    <textarea readonly rows="16" style="width:100%;font-family:monospace;">{{ generated_yaml or '' }}</textarea>
</div>
{% endblock %}
