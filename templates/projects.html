{% extends "_layout.html" %}
{% block title %}Recipe Designer{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="mb-0 text-dark">Recipe Designer Workbench</h2>
    <small class="text-muted">Define platform/project metadata and pipeline scripts with a live YAML preview.</small>
  </div>
</div>

{% if error %}
<div class="alert alert-danger d-flex align-items-center" role="alert">
  <i class="bi bi-exclamation-triangle-fill me-2"></i>
  <div>{{ error }}</div>
</div>
{% endif %}
{% if success %}
<div class="alert alert-success d-flex align-items-center" role="alert">
  <i class="bi bi-check-circle-fill me-2"></i>
  <div>{{ success }}</div>
</div>
{% endif %}

<form method="post" action="/projects">
  <div class="row g-3">
    <div class="col-lg-8">
      <div class="card mb-3">
        <div class="card-body">
          <h6 class="text-muted text-uppercase small mb-3">Metadata</h6>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Platform</label>
              <input type="text" name="platform" value="{{ platform or '' }}" class="form-control" placeholder="e.g. ast2600" required>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Project</label>
              <input type="text" name="project" value="{{ project or '' }}" class="form-control" placeholder="e.g. base" required>
            </div>
            <div class="col-md-12">
              <label class="form-label fw-semibold">Display Name</label>
              <input type="text" name="display_name" value="{{ display_name or '' }}" class="form-control" placeholder="Human-friendly name">
            </div>
            <div class="col-md-12">
              <label class="form-label fw-semibold">Workdir</label>
              <input type="text" name="workdir" value="{{ workdir or '' }}" class="form-control" placeholder="Optional workdir (e.g. onetree)">
            </div>
          </div>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-body">
          <h6 class="text-muted text-uppercase small mb-3">Pipeline Definitions</h6>
          <div class="mb-3">
            <label class="form-label fw-semibold">Clone Commands (one per line)</label>
            <textarea name="clone_lines" rows="4" class="form-control font-monospace" placeholder="git clone ...&#10;cd repo">{{ clone_lines or '' }}</textarea>
          </div>
          <div class="mb-3">
            <label class="form-label fw-semibold">Init Commands (one per line)</label>
            <textarea name="init_lines" rows="4" class="form-control font-monospace" placeholder="source env script&#10;export VAR=...">{{ init_lines or '' }}</textarea>
          </div>
          <div>
            <label class="form-label fw-semibold">Build Commands (one per line)</label>
            <textarea name="build_lines" rows="4" class="form-control font-monospace" placeholder="bitbake ...">{{ build_lines or '' }}</textarea>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-body d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2">
          <div class="text-muted small">Review your inputs, then preview or save the recipe.</div>
          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-outline-secondary">Preview YAML</button>
            <button type="submit" name="save" value="1" class="btn btn-primary">Save Recipe</button>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card position-sticky" style="top: 1rem;">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0 text-dark">Generated YAML</h6>
            <span class="badge bg-light text-dark border">Preview</span>
          </div>
          {% if generated_yaml %}
          <pre class="bg-dark text-light rounded p-3 mb-0" style="min-height: 260px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; white-space: pre-wrap;">{{ generated_yaml }}</pre>
          {% else %}
          <div class="bg-dark text-light rounded p-3" style="min-height: 260px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; white-space: pre-wrap;">
            <span class="text-secondary">Run "Preview YAML" to see the rendered recipe output.</span>
          </div>
          {% endif %}
          <div class="text-muted small mt-2">Schema: Project Template v1. Preview updates without saving; Save writes to presets.</div>
        </div>
      </div>
    </div>
  </div>
</form>
{% endblock %}
